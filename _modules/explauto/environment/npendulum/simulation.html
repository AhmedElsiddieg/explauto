<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>explauto.environment.npendulum.simulation &mdash; explauto 1.1.0 documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="../../../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../../../../_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="../../../../_static/css/font-awesome-ie7.min.css">
<![endif]-->

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>

<link rel="stylesheet" href="../../../../_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../../../_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../../../',
            VERSION:     '1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="../../../../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../../../../_static/underscore.js"></script>
<script type="text/javascript" src="../../../../_static/doctools.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../../../../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
  $(window).load(function () {
    /*

     * Scroll the window to avoid the topnav bar
     * https://github.com/twitter/bootstrap/issues/1768
     */
    if ($(".navbar.navbar-fixed-top").length > 0) {
      // var navHeight = $(".navbar").height(),
      var navHeight = 40,
        shiftWindow = function() { scrollBy(0, -navHeight - 10); };

      if (location.hash) {
        setTimeout(shiftWindow, 1);
      }

      window.addEventListener("hashchange", shiftWindow);
    }
  });
</script>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="top" title="explauto 1.1.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body role="document">
    <div class="navbar navbar-fixed-top " role="navigation" aria-label="top navigation">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div role="banner">
            <a class="brand" href="../../../../index.html">explauto 1.1.0 documentation</a>
          </div>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="../../../../genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="../../../../py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="../../../index.html" accesskey="U">Module code</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-search" action="../../../../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-search" action="../../../../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for explauto.environment.npendulum.simulation</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
<span class="kn">from</span> <span class="nn">sympy.physics.mechanics</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Dummy</span><span class="p">,</span> <span class="n">lambdify</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">hstack</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">arange</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">solve</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>


<div class="viewcode-block" id="step"><a class="viewcode-back" href="../../../../explauto.environment.html#explauto.environment.npendulum.simulation.step">[docs]</a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function creates a sum of boxcar functions.</span>

<span class="sd">    :param numpy.array weight: height of each boxcar function.</span>
<span class="sd">    :param float duration: duration of the generated trajectory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function returns 1 if t is in [0, dt[ and 0 otherwise.</span>

<span class="sd">        :param float t: current time</span>
<span class="sd">        :param float dt: time step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">w</span> <span class="o">*</span> <span class="n">activate</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">)]))</span>

</div>
<div class="viewcode-block" id="simulate"><a class="viewcode-back" href="../../../../explauto.environment.html#explauto.environment.npendulum.simulation.simulate">[docs]</a><span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function simulates the n-pendulum behavior.</span>

<span class="sd">    :param int n: number of particules suspended to the top one</span>
<span class="sd">    :param numpy.array x0: 2*(n+1)-length array, initial conditions (q and u) for each particle</span>
<span class="sd">    :param float dt: time step</span>
<span class="sd">    :param func func: input function that give forces along x_axis for each time t</span>

<span class="sd">    :rtype: array that contains all the coordinates and speeds of each point at time t.</span>

<span class="sd">    **Modifiable arguments**</span>

<span class="sd">    * arm_length (int): length of each segment</span>
<span class="sd">    * bob_mass (int): masse of each particle</span>
<span class="sd">    * t (array): time vector</span>

<span class="sd">    For more advanced setup, change the parameter_vals values. It contains the gravity, the mass and length of each particle.</span>

<span class="sd">    **Understand the code**</span>

<span class="sd">    The explanations below are for those who want to understand how this code works.</span>
<span class="sd">    For more detailed explanations please refer to http://www.moorepants.info/blog/npendulum.html</span>

<span class="sd">    **Variables meaning**</span>

<span class="sd">    - q : Generalized coordinates</span>
<span class="sd">    - u : Generalized speeds</span>
<span class="sd">    - f : Force applied to the cart</span>
<span class="sd">    - m : Mass of each bob</span>
<span class="sd">    - l : Length of each link</span>
<span class="sd">    - g : Gravity</span>
<span class="sd">    - t : Time</span>
<span class="sd">    - I : Inertial reference frame</span>
<span class="sd">    - O : Origin point. Its velocity is zero</span>
<span class="sd">    - P0 : Hinge point of top link</span>
<span class="sd">    - Pa0 : Particle at P0. Its position is q[0] and its velocity is q[0]</span>
<span class="sd">    - forces : List to hold the n + 1 applied forces, including the input force</span>
<span class="sd">    - kindiffs : List to hold kinematic ODE&#39;s</span>

<span class="sd">     In brief, we implement first the frames, points, particles and forces.</span>
<span class="sd">     Then we derive the equations of motion of the system thanks to KanesMethod.</span>
<span class="sd">     Next we define some constants that the user can change (mass, length, etc.), which allow us to set the differential equations, that are formatted by right_hand_side function.</span>
<span class="sd">     This function allows odeint to solve the differential equation.</span>
<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">functor</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function allows us to give to :right_hand_side: function a specific input function.</span>

<span class="sd">        It is necessary because of the format of arguments of odeint.</span>

<span class="sd">        :param func f: input function</span>

<span class="sd">        :rtype: differential equation that will be solved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">right_hand_side</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">args</span><span class="p">))</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">solve</span><span class="p">(</span><span class="n">M_func</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">),</span> <span class="n">F_func</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">dx</span>
        <span class="k">return</span> <span class="n">right_hand_side</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;q:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;u:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&#39;m:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&#39;l:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&#39;g t&#39;</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">ReferenceFrame</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">O</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">)</span>
    <span class="n">O</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="s">&#39;P0&#39;</span><span class="p">)</span>
    <span class="n">P0</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">P0</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Pa0</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="s">&#39;Pa0&#39;</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span><span class="p">]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">P0</span><span class="p">]</span>
    <span class="n">particles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pa0</span><span class="p">]</span>
    <span class="n">forces</span> <span class="o">=</span> <span class="p">[(</span><span class="n">P0</span><span class="p">,</span> <span class="n">f</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>
    <span class="n">kindiffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">orientnew</span><span class="p">(</span><span class="s">&#39;B&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&#39;Axis&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">I</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
        <span class="n">Bi</span><span class="o">.</span><span class="n">set_ang_vel</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bi</span><span class="p">)</span>
        <span class="n">Pi</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">locatenew</span><span class="p">(</span><span class="s">&#39;P&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bi</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Pi</span><span class="o">.</span><span class="n">v2pt_theory</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">I</span><span class="p">,</span> <span class="n">Bi</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Pi</span><span class="p">)</span>
        <span class="n">Pai</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="s">&#39;Pa&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Pai</span><span class="p">)</span>
        <span class="n">forces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Pi</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">I</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">kindiffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">arm_length</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">bob_mass</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">parameter_vals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">arm_length</span><span class="p">,</span> <span class="n">bob_mass</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="n">kane</span> <span class="o">=</span> <span class="n">KanesMethod</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">q_ind</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">u_ind</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">kd_eqs</span><span class="o">=</span><span class="n">kindiffs</span><span class="p">)</span>
    <span class="n">fr</span><span class="p">,</span> <span class="n">frstar</span> <span class="o">=</span> <span class="n">kane</span><span class="o">.</span><span class="n">kanes_equations</span><span class="p">(</span><span class="n">forces</span><span class="p">,</span> <span class="n">particles</span><span class="p">)</span>
    <span class="n">fr</span>
    <span class="n">frstar</span>

    <span class="n">dynamic</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="n">u</span>
    <span class="n">dynamic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dummy_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dummy</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dynamic</span><span class="p">]</span>
    <span class="n">dummy_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dynamic</span><span class="p">,</span> <span class="n">dummy_symbols</span><span class="p">))</span>
    <span class="n">kindiff_dict</span> <span class="o">=</span> <span class="n">kane</span><span class="o">.</span><span class="n">kindiffdict</span><span class="p">()</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">kane</span><span class="o">.</span><span class="n">mass_matrix_full</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">kindiff_dict</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">dummy_dict</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">kane</span><span class="o">.</span><span class="n">forcing_full</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">kindiff_dict</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">dummy_dict</span><span class="p">)</span>
    <span class="n">M_func</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">dummy_symbols</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="n">F_func</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">dummy_symbols</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">functor</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">parameter_vals</span><span class="p">,))</span>

    <span class="k">return</span> <span class="n">y</span>

</div>
<div class="viewcode-block" id="cartesian"><a class="viewcode-back" href="../../../../explauto.environment.html#explauto.environment.npendulum.simulation.cartesian">[docs]</a><span class="k">def</span> <span class="nf">cartesian</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function computes cartesians coordinates from the states returned by the simulate function.</span>

<span class="sd">    :param int n: number of particules suspended to the top one</span>
<span class="sd">    :param numpy.array states: list of the positions and speeds at a certain time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>  <span class="c"># arm_length</span>
    <span class="n">pos_x</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">pos_y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pos_x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_x</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">pos_y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_y</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pos</span></div>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar " role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="../../../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../../../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../../../index.html">explauto 1.1.0 documentation</a></li>
        <li><a href="../../../index.html" >Module code</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2014, Clement Moulin-Frier, Pierre Rouanet.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>